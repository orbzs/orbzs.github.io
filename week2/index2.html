<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Week2 Assignment</title>
  </head>
  <body>
    <script id="Task1">
      function func1(name) {
        let obj1 = {
          悟空: { x: 0, y: 0, z: 0 },
          丁滿: { x: -1, y: 4, z: 2 },
          辛巴: { x: -3, y: 3, z: 0 },
          貝吉塔: { x: -4, y: -1, z: 0 },
          特南克斯: { x: 1, y: -2, z: 0 },
          弗利沙: { x: 4, y: -1, z: 2 },
        };
        //
        let target = obj1[name];
        let result = {};
        for (let key in obj1) {
          if (key === name) {
            continue;
          }
          let dist =
            Math.abs(target.x - obj1[key].x) + Math.abs(target.y - obj1[key].y);
          if (target.z !== obj1[key].z) {
            dist += 2;
          }
          result[key] = dist;
        }
        //
        let minDist = Math.min(...Object.values(result));
        let maxDist = Math.max(...Object.values(result));
        let nearest = [];
        let farthest = [];
        for (let key in result) {
          if (result[key] === maxDist) {
            farthest.push(key);
          }
          if (result[key] === minDist) {
            nearest.push(key);
          }
        }
        console.log(`最遠${farthest.join("、")}；最近${nearest.join("、")}`);
      }
      func1("辛巴"); // print 最遠弗利沙；最近丁滿、貝吉塔
      func1("悟空"); // print 最遠丁滿、弗利沙；最近特南克斯
      func1("弗利沙"); // print 最遠辛巴，最近特南克斯
      func1("特南克斯"); // print 最遠丁滿，最近悟空
    </script>
    <script id="Task2">
      //
      const bookings = {};
      function func2(ss, start, end, criteria) {
        //
        const regex = /([a-zA-Z]+)(>=|<=|=)([a-zA-Z0-9.]+)/;
        const match = criteria.match(regex);
        const field = match[1];
        const operator = match[2];
        const value = match[3];
        //
        let candidates = [];
        for (let i = 0; i < ss.length; i++) {
          const s = ss[i];
          let isMatch = false;
          if (field === "name") {
            isMatch = s[field] === value;
          } else {
            const numValue = Number(value);
            if (operator === ">=") isMatch = s[field] >= numValue;
            else if (operator === "<=") isMatch = s[field] <= numValue;
          }

          if (isMatch) {
            bookings[s.name] = bookings[s.name] || [];
            let available = true;
            for (let p of bookings[s.name]) {
              if (!(end <= p.start || start >= p.end)) {
                available = false;
                break;
              }
            }
            if (available) candidates.push(s);
          }
        }
        //
        let bestService = null;
        if (candidates.length > 0) {
          if (operator === "=") {
            bestService = candidates[0];
          } else if (operator === ">=") {
            let minDiff = Infinity;
            const numValue = Number(value);
            for (let s of candidates) {
              const diff = s[field] - numValue;
              if (diff >= 0 && diff < minDiff) {
                minDiff = diff;
                bestService = s;
              }
            }
          } else if (operator === "<=") {
            let maxVal = -Infinity;
            const numValue = Number(value);
            for (let s of candidates) {
              if (s[field] <= numValue && s[field] > maxVal) {
                maxVal = s[field];
                bestService = s;
              }
            }
          }
        }
        //
        if (bestService) {
          bookings[bestService.name].push({ start, end });
          console.log(bestService.name);
        } else {
          console.log("Sorry");
        }
      }

      const services = [
        { name: "S1", r: 4.5, c: 1000 },
        { name: "S2", r: 3, c: 1200 },
        { name: "S3", r: 3.8, c: 800 },
      ];

      // 測試
      func2(services, 15, 17, "c>=800"); // S3
      func2(services, 11, 13, "r<=4"); // S3
      func2(services, 10, 12, "name=S3"); // Sorry
      func2(services, 15, 18, "r>=4.5"); // S1
      func2(services, 16, 18, "r>=4"); // Sorry
      func2(services, 13, 17, "name=S1"); // Sorry
      func2(services, 8, 9, "c<=1500"); // S2
      func2(services, 8, 9, "c<=1500"); // S1
    </script>
    <script id="Task3">
      function func3(index) {
        let arr = [25];

        if (index == 0) {
          console.log(arr[index]);
          return;
        }

        for (i = 1; i <= index; i++) {
          if (i % 4 == 1) {
            arr.push(arr[i - 1] - 2);
          } else if (i % 4 == 2) {
            arr.push(arr[i - 1] - 3);
          } else if (i % 4 == 3) {
            arr.push(arr[i - 1] + 1);
          } else if (i % 4 == 0) {
            arr.push(arr[i - 1] + 2);
          }
        }
        console.log(arr[index]);
      }
      func3(1); // print 23
      func3(5); // print 21
      func3(10); // print 16
      func3(30); // print 6
    </script>
    <script id="Task4">
      function func4(sp, stat, n) {
        let statSplit = stat.split("");
        let statNumArr = statSplit.map((str) => parseInt(str, 10));
        //
        var pair = sp.map(function (space, index) {
          return { index: index, space: sp[index], stat: statNumArr[index] };
        });
        //
        let availableCars = pair.filter(function (car) {
          return car.stat === 0;
        });
        //
        let minDiff = Infinity;
        let bestCarIndex = -1;
        for (let i = 0; i < availableCars.length; i++) {
          let diff = Math.abs(availableCars[i].space - n);
          if (diff < minDiff) {
            minDiff = diff;
            bestCarIndex = availableCars[i].index;
          }
        }
        console.log(bestCarIndex);
      }
      func4([3, 1, 5, 4, 3, 2], "101000", 2); // print 5
      func4([1, 0, 5, 1, 3], "10100", 4); // print 4
      func4([4, 6, 5, 8], "1000", 4); // print 2
    </script>
  </body>
</html>
